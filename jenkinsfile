pipeline{
    agent any
    stages{
        stage('build'){
            steps{
                echo "building AutomationFramework.."
                sh 'mvn clean compile'
                }
        }
        stage('test'){
            steps{
                echo "testing AutomationFramework.."
                catchError(buildResult: 'SUCCESS', stageResult: 'FAILURE'){
                sh 'mvn test -DsuiteXmlFile=src/testng.xml'
                }
            }
        }
        stage('Generate Allure report'){
            steps{
                catchError(buildResult: 'SUCCESS', stageResult: 'FAILURE'){
                sh "mvn allure:report"
                allure results: [[path: 'allure-results']]            
                }
            }
            post {
            always {
            echo "Allure report generated even if tests failed"
        }
    }
        }
        stage('deploy'){
            when {
                expression { currentBuild.currentResult == 'SUCCESS' }
            }
            steps{
                echo "deploying AutomationFramework.."
            }
        }
    }
}
pipeline{
    agent any
    stages{
        stage('build'){
            steps{
                echo "building AutomationFramework.."
                bat "mvn clean"
                bat "dir /s allure-results"
            }
        }
        stage('test'){
            steps{
                echo "testing AutomationFramework.."
                catchError(buildResult: 'SUCCESS', stageResult: 'FAILURE'){
                 bat "mvn test"
                }
            }
        }
        stage('compile'){
            when{
                expression {currentBuild.currentResult == 'SUCCESS'}
            }
            steps{
                echo "compiling AutomationFramework.."
                bat "mvn compile"
            }
        }
        stage('Generate Allure report'){
            steps{
                bat "mvn allure:report"
                allure includeProperties: false, jdk: '', results: [[path: 'allure-results']], commandline: 'allure'
            }
        }
        stage('deploy'){
            when {
                expression { currentBuild.currentResult == 'SUCCESS' }
            }
            steps{
                echo "deploying AutomationFramework.."
            }
        }
    }
}